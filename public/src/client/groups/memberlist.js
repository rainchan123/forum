"use strict";define("forum/groups/memberlist",["api"],function(e){var t={};var r;var n;var a;t.init=function(e){a=e||"groups/details";n=ajaxify.data.group.name;o();i();u()};function o(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(t){var r=[];var n=bootbox.dialog({title:"[[groups:details.add-member]]",message:t,buttons:{ok:{callback:function(){var e=[];n.find("[data-uid][data-selected]").each(function(t,n){e.push(r[$(n).attr("data-uid")])});s(e,function(){n.modal("hide")})}}}});n.on("click","[data-username]",function(){var e=$(this).attr("data-selected")==="1";if(e){$(this).removeAttr("data-selected")}else{$(this).attr("data-selected",1)}$(this).find("i").toggleClass("invisible")});n.find("input").on("keyup",function(){e.get("/api/users",{query:$(this).val(),paginate:false},function(e,t){if(e){return app.alertError(e.message)}t.users.forEach(function(e){r[e.uid]=e});app.parseAndTranslate("admin/partials/groups/add-members","users",{users:t.users},function(e){n.find("#search-result").html(e)})})})})})}function s(t,r){function a(){t=t.filter(function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length});c(t,function(e){$('[component="groups/members"] tbody').prepend(e)});r()}var o=t.map(function(e){return e.uid});if(n==="administrators"){socket.emit("admin.user.makeAdmins",o,function(e){if(e){return app.alertError(e)}a()})}else{Promise.all(o.map(t=>e.put("/groups/"+ajaxify.data.group.slug+"/membership/"+t))).then(a).catch(app.alertError)}}function i(){$('[component="groups/members/search"]').on("keyup",function(){var e=$(this).val();if(r){clearInterval(r);r=0}r=setTimeout(function(){socket.emit("groups.searchMembers",{groupName:n,query:e},function(e,t){if(e){return app.alertError(e.message)}c(t.users,function(e){$('[component="groups/members"] tbody').html(e);$('[component="groups/members"]').attr("data-nextstart",20)})})},250)})}function u(){$('[component="groups/members"] tbody').on("scroll",function(){var e=$(this);var t=(e[0].scrollHeight-e.innerHeight())*.9;if(e.scrollTop()>t&&!$('[component="groups/members/search"]').val()){m()}})}function m(){var e=$('[component="groups/members"]');if(e.attr("loading")){return}e.attr("loading",1);socket.emit("groups.loadMoreMembers",{groupName:n,after:e.attr("data-nextstart")},function(t,r){if(t){return app.alertError(t.message)}if(r&&r.users.length){p(r.users,function(){e.removeAttr("loading");e.attr("data-nextstart",r.nextStart)})}else{e.removeAttr("loading")}})}function p(e,t){e=e.filter(function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length});c(e,function(e){$('[component="groups/members"] tbody').append(e);t()})}function c(e,t){app.parseAndTranslate(a,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},t)}return t});
//# sourceMappingURL=memberlist.js.map