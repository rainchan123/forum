"use strict";define("forum/account/edit",["forum/account/header","translator","pictureCropper","benchpress","api"],function(a,t,e,i,r){var n={};n.init=function(){a.init();$("#submitBtn").on("click",o);app.loadJQueryUI(function(){$("#inputBirthday").datepicker({changeMonth:true,changeYear:true,yearRange:"1900:-5y",defaultDate:"-13y"})});c();l();f();m();h();g()};function o(){var a={uid:$("#inputUID").val(),fullname:$("#inputFullname").val(),website:$("#inputWebsite").val(),birthday:$("#inputBirthday").val(),location:$("#inputLocation").val(),groupTitle:$("#groupTitle").val(),signature:$("#inputSignature").val(),aboutme:$("#inputAboutMe").val()};a.groupTitle=JSON.stringify(Array.isArray(a.groupTitle)?a.groupTitle:[a.groupTitle]);$(window).trigger("action:profile.update",a);r.put("/users/"+a.uid,a).then(a=>{app.alertSuccess("[[user:profile_update_success]]");if(a.picture){$("#user-current-picture").attr("src",a.picture)}u(a.picture)}).catch(app.alertError);return false}function u(a){if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10)){return}if(!a&&ajaxify.data.defaultAvatar){a=ajaxify.data.defaultAvatar}$('#header [component="avatar/picture"]')[a?"show":"hide"]();$('#header [component="avatar/icon"]')[!a?"show":"hide"]();if(a){$('#header [component="avatar/picture"]').attr("src",a)}}function c(){$("#changePictureBtn").on("click",function(){socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,t){if(a){return app.alertError(a.message)}var e=t.reduce(function(a,t){return a||t.type==="uploaded"},false);app.parseAndTranslate("partials/modals/change_picture_modal",{pictures:t,uploaded:e,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads},function(a){var t=bootbox.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:a,show:true,buttons:{close:{label:"[[global:close]]",callback:r,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:i}}});t.on("shown.bs.modal",e);t.on("click",".list-group-item",function a(){t.find(".list-group-item").removeClass("active");$(this).addClass("active")});s(t);function e(){if(!ajaxify.data.picture){t.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active")}else{t.find(".list-group-item img").each(function(){if(this.getAttribute("src")===ajaxify.data.picture){$(this).parents(".list-group-item").addClass("active")}})}}function i(){var a=t.find(".list-group-item.active").attr("data-type");p(a,function(e){if(e){return app.alertError(e.message)}u(a==="default"?"":t.find(".list-group-item.active img").attr("src"));ajaxify.refresh()})}function r(){t.modal("hide")}})});return false})}function l(){$("#deleteAccountBtn").on("click",function(){t.translate("[[user:delete_account_confirm]]",function(a){var e=bootbox.confirm(a+'<p><input type="password" class="form-control" id="confirm-password" /></p>',function(a){if(!a){return}var i=e.find(".btn-primary");i.html('<i class="fa fa-spinner fa-spin"></i>');i.prop("disabled",true);socket.emit("user.deleteAccount",{password:$("#confirm-password").val()},function(a){function e(){t.translate("[[modules:bootbox.confirm]]",function(a){i.text(a);i.prop("disabled",false)})}if(a){e();return app.alertError(a.message)}i.html('<i class="fa fa-check"></i>');window.location.href=config.relative_path+"/"});return false});e.on("shown.bs.modal",function(){e.find("input").focus()})});return false})}function s(a){function t(a){a=(!a.startsWith("http")?config.relative_path:"")+a+"?"+Date.now();u(a);if(ajaxify.data.picture&&ajaxify.data.picture.length){$("#user-current-picture, img.avatar").attr("src",a);ajaxify.data.uploadedpicture=a}else{ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",a)})}}function i(){if(ajaxify.data.uploadedpicture===ajaxify.data.picture){ajaxify.refresh();u()}}a.find('[data-action="upload"]').on("click",function(){a.modal("hide");e.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:false,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(a){t(a)});return false});a.find('[data-action="upload-url"]').on("click",function(){a.modal("hide");app.parseAndTranslate("partials/modals/upload_picture_from_url_modal",{},function(a){a.modal("show");a.find(".upload-btn").on("click",function(){var i=a.find("#uploadFromUrl").val();if(!i){return false}a.modal("hide");e.handleImageCrop({url:i,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:false,paramName:"uid",paramValue:ajaxify.data.theirid},t);return false})});return false});a.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(t){a.modal("hide");if(t){return app.alertError(t.message)}i()})})}function f(){$("#confirm-email").on("click",function(){var a=$(this).attr("disabled",true);socket.emit("user.emailConfirm",{},function(t){a.removeAttr("disabled");if(t){return app.alertError(t.message)}app.alertSuccess("[[notifications:email-confirm-sent]]")})})}function p(a,t){socket.emit("user.changePicture",{type:a,uid:ajaxify.data.theirid},t)}function d(a,t){return a.length?"("+a.val().length+"/"+t+")":""}function m(){var a=$("#inputSignature");$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength));a.on("keyup change",function(){$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength))})}function h(){var a=$("#inputAboutMe");$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength));a.on("keyup change",function(){$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength))})}function g(){function a(a){var t=$("#groupTitle").val();if(!ajaxify.data.allowMultipleBadges||Array.isArray(t)&&t.length>1){return}var e=$("#groupTitle").find(":selected");if(e.length&&e.val()){if(a>0){e.insertAfter(e.next())}else if(e.prev().val()){e.insertBefore(e.prev())}}}$('[component="group/order/up"]').on("click",function(){a(-1)});$('[component="group/order/down"]').on("click",function(){a(1)})}return n});
//# sourceMappingURL=edit.js.map