"use strict";define("forum/account/header",["coverPhoto","pictureCropper","components","translator","benchpress","accounts/delete","api"],function(a,t,e,n,o,i,c){var r={};var u;r.init=function(){u=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator;s();f();if(u){d()}e.get("account/follow").on("click",function(){p("follow")});e.get("account/unfollow").on("click",function(){p("unfollow")});e.get("account/chat").on("click",function(){socket.emit("modules.chats.hasPrivateChat",ajaxify.data.uid,function(a,t){if(a){return app.alertError(a.message)}if(t){app.openChat(t)}else{app.newChat(ajaxify.data.uid)}})});e.get("account/new-chat").on("click",function(){app.newChat(ajaxify.data.uid,function(){e.get("account/chat").parent().removeClass("hidden")})});e.get("account/ban").on("click",function(){h(ajaxify.data.theirid)});e.get("account/unban").on("click",g);e.get("account/delete-account").on("click",l.bind(null,"account"));e.get("account/delete-content").on("click",l.bind(null,"content"));e.get("account/delete-all").on("click",l.bind(null,"purge"));e.get("account/flag").on("click",m);e.get("account/block").on("click",b)};function l(a){i[a](ajaxify.data.theirid)}r.banAccount=h;function s(){if(!app.user.uid||app.user.uid!==parseInt(ajaxify.data.theirid,10)){$(".account-sub-links .plugin-link.private").addClass("hide")}}function f(){$(".account-sub-links li").removeClass("active").each(function(){var a=$(this).find("a").attr("href");if(decodeURIComponent(a)===decodeURIComponent(window.location.pathname)){$(this).addClass("active");return false}})}function d(){a.init(e.get("account/cover"),function(a,t,e){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:a,position:t},e)},function(){t.show({title:"[[user:upload_cover_picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:true,restrictImageDimension:false,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(a){a=(!a.startsWith("http")?config.relative_path:"")+a+"?"+Date.now();e.get("account/cover").css("background-image","url("+a+")")})},k)}function p(a){c[a==="follow"?"put":"delete"]("/users/"+ajaxify.data.uid+"/follow",undefined,function(t){if(t){return app.alertError(t)}e.get("account/follow").toggleClass("hide",a==="follow");e.get("account/unfollow").toggleClass("hide",a==="unfollow");app.alertSuccess("[[global:alert."+a+", "+ajaxify.data.username+"]]")});return false}function h(a,t){a=a||ajaxify.data.theirid;o.render("admin/partials/temporary-ban",{}).then(function(e){bootbox.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:e,show:true,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban_account]]",callback:function(){var e=$(".ban-modal form").serializeArray().reduce(function(a,t){a[t.name]=t.value;return a},{});var n=e.length>0?Date.now()+e.length*1e3*60*60*(parseInt(e.unit,10)?24:1):0;c.put("/users/"+a+"/ban",{until:n,reason:e.reason||""}).then(()=>{if(typeof t==="function"){return t()}ajaxify.refresh()}).catch(app.alertError)}}}})})}function g(){c.del("/users/"+ajaxify.data.theirid+"/ban").then(()=>{ajaxify.refresh()}).catch(app.alertError)}function m(){require(["flags"],function(a){a.showFlagModal({type:"user",id:ajaxify.data.uid})})}function b(){var a=this;socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid},function(t,e){if(t){return app.alertError(t.message)}n.translate("[[user:"+(e?"unblock":"block")+"_user]]",function(t){$(a).text(t)})});return false}function k(){n.translate("[[user:remove_cover_picture_confirm]]",function(a){bootbox.confirm(a,function(a){if(!a){return}socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(a){if(!a){ajaxify.refresh()}else{app.alertError(a.message)}})})})}return r});
//# sourceMappingURL=header.js.map