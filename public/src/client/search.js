"use strict";define("forum/search",["search","autocomplete","storage"],function(e,s,t){var a={};a.init=function(){var s=$("#results").attr("data-search-query");var t=$("#search-in");t.on("change",function(){i(t.val())});e.highlightMatches(s,$(".search-result-text p, .search-result-text.search-result-title a"));$("#advanced-search").off("submit").on("submit",function(s){s.preventDefault();e.query(r(),function(){$("#search-input").val("")});return false});c();o();n()};function r(){var e=$("#advanced-search");var s={in:$("#search-in").val()};s.term=$("#search-input").val();if(s.in==="posts"||s.in==="titlesposts"||s.in==="titles"){s.matchWords=e.find("#match-words-filter").val();s.by=e.find("#posted-by-user").tagsinput("items");s.categories=e.find("#posted-in-categories").val();s.searchChildren=e.find("#search-children").is(":checked");s.hasTags=e.find("#has-tags").tagsinput("items");s.replies=e.find("#reply-count").val();s.repliesFilter=e.find("#reply-count-filter").val();s.timeFilter=e.find("#post-time-filter").val();s.timeRange=e.find("#post-time-range").val();s.sortBy=e.find("#post-sort-by").val();s.sortDirection=e.find("#post-sort-direction").val();s.showAs=e.find("#show-as-topics").is(":checked")?"topics":"posts"}$(window).trigger("action:search.getSearchDataFromDOM",{form:e,data:s});return s}function i(e){var s=e.indexOf("posts")===-1&&e.indexOf("titles")===-1;$(".post-search-item").toggleClass("hide",s)}function n(){var s=utils.params({disableToType:true});var t=e.getSearchPreferences();var a=utils.merge(t,s);if(a){if(ajaxify.data.term){$("#search-input").val(ajaxify.data.term)}a.in=a.in||"posts";$("#search-in").val(a.in);i(a.in);if(a.matchWords){$("#match-words-filter").val(a.matchWords)}if(a.by){a.by=Array.isArray(a.by)?a.by:[a.by];a.by.forEach(function(e){$("#posted-by-user").tagsinput("add",e)})}if(a.categories){$("#posted-in-categories").val(a.categories)}if(a.searchChildren){$("#search-children").prop("checked",true)}if(a.hasTags){a.hasTags=Array.isArray(a.hasTags)?a.hasTags:[a.hasTags];a.hasTags.forEach(function(e){$("#has-tags").tagsinput("add",e)})}if(a.replies){$("#reply-count").val(a.replies);$("#reply-count-filter").val(a.repliesFilter)}if(a.timeRange){$("#post-time-range").val(a.timeRange);$("#post-time-filter").val(a.timeFilter)}if(a.sortBy||ajaxify.data.searchDefaultSortBy){$("#post-sort-by").val(a.sortBy||ajaxify.data.searchDefaultSortBy)}$("#post-sort-direction").val(a.sortDirection||"desc");if(a.showAs){var r=a.showAs==="topics";var n=a.showAs==="posts";$("#show-as-topics").prop("checked",r).parent().toggleClass("active",r);$("#show-as-posts").prop("checked",n).parent().toggleClass("active",n)}$(window).trigger("action:search.fillOutForm",{form:a})}}function c(){$("#save-preferences").on("click",function(){t.setItem("search-preferences",JSON.stringify(r()));app.alertSuccess("[[search:search-preferences-saved]]");return false});$("#clear-preferences").on("click",function(){t.removeItem("search-preferences");var e=$("#search-input").val();$("#advanced-search")[0].reset();$("#search-input").val(e);app.alertSuccess("[[search:search-preferences-cleared]]");return false})}function o(){var e=$("#posted-by-user");e.tagsinput({confirmKeys:[13,44],trimValue:true});if(app.user.privileges["search:users"]){s.user(e.siblings(".bootstrap-tagsinput").find("input"))}var t=$("#has-tags");t.tagsinput({confirmKeys:[13,44],trimValue:true});if(app.user.privileges["search:tags"]){s.tag(t.siblings(".bootstrap-tagsinput").find("input"))}}return a});
//# sourceMappingURL=search.js.map