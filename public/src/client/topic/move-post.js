"use strict";define("forum/topic/move-post",["components","postSelect","translator","alerts","api"],function(t,i,a,e,o){var n={};var s;var d;var p;n.init=function(t){if(s){return}p=ajaxify.data.tid;app.parseAndTranslate("modals/move-post",{},function(a){s=a;d=s.find("#move_posts_confirm");$("body").append(s);s.find(".close,#move_posts_cancel").on("click",u);i.init(l);c();if(t){i.togglePostSelection(t,t.attr("data-pid"))}$(window).off("action:ajaxify.end",f).on("action:ajaxify.end",f);d.on("click",function(){if(!ajaxify.data.template.topic||!ajaxify.data.tid){return}d.attr("disabled",true);var t={pids:i.pids.slice(),tid:ajaxify.data.tid};e.alert({alert_id:"pids_move_"+i.pids.join("-"),title:"[[topic:thread_tools.move-posts]]",message:"[[topic:topic_move_posts_success]]",type:"success",timeout:1e4,timeoutfn:function(){r(t)},clickfn:function(t,i){delete i.timeoutfn;app.alertSuccess("[[topic:topic_move_posts_undone]]");d.removeAttr("disabled")}})})})};function c(){if(!s){return}if(i.pids.length){if(ajaxify.data.template.topic&&ajaxify.data.tid&&ajaxify.data.tid!==p){var t=a.compile("topic:x-posts-will-be-moved-to-y",i.pids.length,ajaxify.data.title);s.find("#pids").translateHtml(t)}else{s.find("#pids").translateHtml("[[topic:x-posts-selected, "+i.pids.length+"]]")}}else{s.find("#pids").translateHtml("[[topic:no-posts-selected]]")}}function f(){if(!s){return}if(i.pids.length&&ajaxify.data.tid&&ajaxify.data.template.topic&&ajaxify.data.tid!==p){d.removeAttr("disabled")}else{d.attr("disabled",true)}c()}function l(){f()}function r(i){if(!ajaxify.data.template.topic||!i.tid){return}Promise.all(i.pids.map(t=>o.put(`/posts/${t}/move`,{tid:i.tid}))).then(()=>{i.pids.forEach(function(i){t.get("post","pid",i).fadeOut(500,function(){$(this).remove()})});u()}).catch(app.alertError)}function u(){if(s){s.remove();s=null;i.disable()}}return n});
//# sourceMappingURL=move-post.js.map