"use strict";define("forum/topic/events",["forum/topic/postTools","forum/topic/threadTools","forum/topic/posts","forum/topic/images","components","translator","benchpress"],function(t,e,o,a,n,i,s){var p={};var r={"event:user_status_change":d,"event:voted":c,"event:bookmarked":u,"event:topic_deleted":e.setDeleteState,"event:topic_restored":e.setDeleteState,"event:topic_purged":f,"event:topic_locked":e.setLockedState,"event:topic_unlocked":e.setLockedState,"event:topic_pinned":e.setPinnedState,"event:topic_unpinned":e.setPinnedState,"event:topic_moved":l,"event:post_edited":g,"event:post_purged":m,"event:post_deleted":k,"event:post_restored":k,"posts.bookmark":h,"posts.unbookmark":h,"posts.upvote":I,"posts.downvote":I,"posts.unvote":I,"event:new_notification":w,"event:new_post":o.onNewPost};p.init=function(){p.removeListeners();for(var t in r){if(r.hasOwnProperty(t)){socket.on(t,r[t])}}};p.removeListeners=function(){for(var t in r){if(r.hasOwnProperty(t)){socket.removeListener(t,r[t])}}};function d(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function c(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});var o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes);o.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function u(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function f(t){if(ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)){ajaxify.go("category/"+ajaxify.data.category.slug,null,true)}}function l(t){if(t&&t.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)){ajaxify.go("topic/"+t.slug,null,true)}}function g(e){if(!e||!e.post||parseInt(e.post.tid,10)!==parseInt(ajaxify.data.tid,10)){return}var p=n.get("post/content",e.post.pid).filter(function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});var r=$('[data-pid="'+e.post.pid+'"] [component="post/editor"]').filter(function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});var d=n.get("topic/title");var c=n.get("navbar/title").find("span");var u=n.get("breadcrumb/current");if(d.length&&e.topic.title&&e.topic.renamed){ajaxify.data.title=e.topic.title;var f="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:f},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+f);d.fadeOut(250,function(){d.html(e.topic.title).fadeIn(250)});u.fadeOut(250,function(){u.html(e.topic.title).fadeIn(250)});c.fadeOut(250,function(){c.html(e.topic.title).fadeIn(250)})}if(e.post.changed){p.fadeOut(250,function(){p.html(i.unescape(e.post.content));p.find("img:not(.not-responsive)").addClass("img-responsive");a.wrapImagesInLinks(p.parent());o.addBlockquoteEllipses(p.parent());p.fadeIn(250);var t={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};app.parseAndTranslate("partials/topic/post-editor",t,function(t){r.replaceWith(t);$('[data-pid="'+e.post.pid+'"] [component="post/editor"] .timeago').timeago();$(window).trigger("action:posts.edited",e)})})}else{$(window).trigger("action:posts.edited",e)}if(e.topic.tags&&v(e.topic.tags)){s.render("partials/topic/tags",{tags:e.topic.tags}).then(function(t){var e=$(".tags");e.fadeOut(250,function(){e.html(t).fadeIn(250)})})}t.removeMenu(n.get("post","pid",e.post.pid))}function v(t){if(t.length!==$(".tags").first().children().length){return true}for(var e=0;e<t.length;e+=1){if(!$('.tags .tag-item[data-tag="'+t[e].value+'"]').length){return true}}return false}function m(e){if(!e||parseInt(e.tid,10)!==parseInt(ajaxify.data.tid,10)){return}n.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove();o.showBottomPostBar()});ajaxify.data.postcount-=1;t.updatePostCount(ajaxify.data.postcount);require(["forum/topic/replies"],function(t){t.onPostPurged(e)})}function k(e){var o=n.get("post","pid",e.pid);if(!o.length){return}o.toggleClass("deleted");var a=o.hasClass("deleted");t.toggle(e.pid,a);if(!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)){o.find('[component="post/tools"]').toggleClass("hidden",a);if(a){o.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]")}else{o.find('[component="post/content"]').html(i.unescape(e.content))}}}function h(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});if(!e.length){return}e.attr("data-bookmarked",t.isBookmarked);e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked);e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked)}function I(t){var e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote);e.find('[component="post/downvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function w(t){var e=ajaxify.data.tid;if(t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)){socket.emit("topics.markTopicNotificationsRead",[e])}}return p});
//# sourceMappingURL=events.js.map