"use strict";define("forum/register",["translator","zxcvbn","slugify","api","jquery-form"],function(e,r,a,s){var n={};var i=false;var t="";n.init=function(){var r=$("#email");var s=$("#username");var n=$("#password");var t=$("#password-confirm");var m=$("#register");c();$("#referrer").val(app.previousUrl);$("#content #noscript").val("false");r.on("blur",function(){if(r.val().length){o(r.val())}});var d=utils.params();if(d.email&&d.token){r.val(decodeURIComponent(d.email));$("#token").val(d.token)}s.on("keyup",function(){$("#yourUsername").text(this.value.length>0?a(this.value):"username")});s.on("blur",function(){if(s.val().length){l(s.val())}});n.on("blur",function(){if(n.val().length){f(n.val(),t.val())}});t.on("blur",function(){if(t.val().length){u(n.val(),t.val())}});function v(e){i=false;f(n.val(),t.val());u(n.val(),t.val());o(r.val(),function(){l(s.val(),e)})}m.on("click",function(r){var a=$(this);var s=$("#register-error-notify");s.addClass("hidden");r.preventDefault();v(function(){if(i){return}a.addClass("disabled");a.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(r){a.removeClass("disabled");if(!r){return}if(r.referrer){var s=utils.urlToLocation(r.referrer).pathname;var n=utils.params({url:r.referrer});n.registered=true;var i=decodeURIComponent($.param(n));window.location.href=s+"?"+i}else if(r.message){e.translate(r.message,function(e){bootbox.alert(e);ajaxify.go("/")})}},error:function(r){e.translate(r.responseText,config.defaultLang,function(e){if(r.status===403&&r.responseText==="Forbidden"){window.location.href=config.relative_path+"/register?error=csrf-invalid"}else{s.find("p").text(e);s.removeClass("hidden");a.removeClass("disabled")}})}})})});$("#email").focus()};function o(e,r){r=r||function(){};var a=$("#email-notify");if(!utils.isEmailValid(e)){m(a,"[[error:invalid-email]]");return r()}socket.emit("user.emailExists",{email:e},function(e,s){if(e){app.alertError(e.message);return r()}if(s){m(a,"[[error:email-taken]]")}else{d(a,t)}r()})}function l(e,r){r=r||function(){};var n=$("#username-notify");var i=a(e);if(e.length<ajaxify.data.minimumUsernameLength||i.length<ajaxify.data.minimumUsernameLength){m(n,"[[error:username-too-short]]")}else if(e.length>ajaxify.data.maximumUsernameLength){m(n,"[[error:username-too-long]]")}else if(!utils.isUserNameValid(e)||!i){m(n,"[[error:invalid-username]]")}else{Promise.allSettled([s.head(`/users/bySlug/${e}`,{}),s.head(`/groups/${e}`,{})]).then(e=>{if(e.every(e=>e.status==="rejected")){d(n,t)}else{m(n,"[[error:username-taken]]")}r()})}}function f(e,a){var s=$("#password-notify");var n=$("#password-confirm-notify");var i=r(e);if(e.length<ajaxify.data.minimumPasswordLength){m(s,"[[reset_password:password_too_short]]")}else if(e.length>512){m(s,"[[error:password-too-long]]")}else if(!utils.isPasswordValid(e)){m(s,"[[user:change_password_error]]")}else if(e===$("#username").val()){m(s,"[[user:password_same_as_username]]")}else if(e===$("#email").val()){m(s,"[[user:password_same_as_email]]")}else if(i.score<ajaxify.data.minimumPasswordStrength){m(s,"[[user:weak_password]]")}else{d(s,t)}if(e!==a&&a!==""){m(n,"[[user:change_password_error_match]]")}}function u(e,r){var a=$("#password-notify");var s=$("#password-confirm-notify");if(!e||a.hasClass("alert-error")){return}if(e!==r){m(s,"[[user:change_password_error_match]]")}else{d(s,t)}}function m(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-success").addClass("register-danger");r.show()});i=true}function d(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-danger").addClass("register-success");r.show()})}function c(){if(!app.user.uid&&config.defaultLang!==config.userLang){var e=$('[component="register/local"]');var r=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');e.append(r)}}return n});
//# sourceMappingURL=register.js.map