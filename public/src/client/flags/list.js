"use strict";define("forum/flags/list",["components","Chart"],function(e,a){var t={};t.init=function(){t.enableFilterForm();t.enableCheckboxes();t.handleBulkActions();e.get("flags/list").on("click","[data-flag-id]",function(e){if(["BUTTON","A"].includes(e.target.nodeName)){return}var a=this.getAttribute("data-flag-id");ajaxify.go("flags/"+a)});var a=$("#flags-daily-wrapper");var n=a.siblings(".panel-footer");$("#flags-daily-wrapper").one("shown.bs.collapse",function(){t.handleGraphs()});n.on("click",a.collapse.bind(a,"toggle"))};t.enableFilterForm=function(){var a=e.get("flags/filters");for(var t in ajaxify.data.filters){if(ajaxify.data.filters.hasOwnProperty(t)){a.find('[name="'+t+'"]').val(ajaxify.data.filters[t])}}a.find('[name="sort"]').val(ajaxify.data.sort);document.getElementById("apply-filters").addEventListener("click",function(){var e=a.serializeArray();ajaxify.go("flags?"+(e.length?$.param(e):"reset=1"))})};t.enableCheckboxes=function(){var e=document.querySelector('[component="flags/list"]');var a=e.querySelectorAll('[data-flag-id] input[type="checkbox"]');var t=document.querySelector('[component="flags/bulk-actions"] button');var n;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){var e=this.checked;a.forEach(function(a){a.checked=e});t.disabled=!e});e.addEventListener("click",function(e){var r=e.target.closest('input[type="checkbox"]');if(r){e.stopImmediatePropagation();if(n&&e.shiftKey&&n!==r){var i=r.checked;var o=false;a.forEach(function(e){if([r,n].some(function(a){return a===e})){o=!o}if(o){e.checked=i}})}t.disabled=!Array.prototype.some.call(a,function(e){return e.checked});n=r}if(e.target.querySelector('input[type="checkbox"]')){e.stopImmediatePropagation()}})};t.handleBulkActions=function(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(e){var a=e.target.closest("[data-action]");if(a){var n=a.getAttribute("data-action");var r=t.getSelected();var i=[];r.forEach(function(e){i.push(new Promise(function(a,t){var r=function(e){if(e){t(e)}a(arguments[1])};switch(n){case"bulk-assign":socket.emit("flags.update",{flagId:e,data:[{name:"assignee",value:app.user.uid}]},r);break;case"bulk-mark-resolved":socket.emit("flags.update",{flagId:e,data:[{name:"state",value:"resolved"}]},r);break}}))});Promise.allSettled(i).then(function(e){var a=e.filter(function(e){return e.status==="fulfilled"}).length;var t=e.filter(function(e){return e.status==="rejected"});if(a){app.alertSuccess("[[flags:bulk-success, "+a+"]]");ajaxify.refresh()}t.forEach(function(e){app.alertError(e.reason)})})}})};t.getSelected=function(){var e=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]');var a=[];e.forEach(function(e){if(e.checked){a.push(e.closest("[data-flag-id]").getAttribute("data-flag-id"))}});return a};t.handleGraphs=function(){var e=document.getElementById("flags:daily");var t=utils.getDaysArray().map(function(e,a){return a%3?"":e});if(utils.isMobile()){a.defaults.global.tooltips.enabled=false}var n={"flags:daily":{labels:t,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};e.width=$(e).parent().width();new a(e.getContext("2d"),{type:"line",data:n["flags:daily"],options:{responsive:true,animation:false,legend:{display:false},scales:{yAxes:[{ticks:{beginAtZero:true,precision:0}}]}}})};return t});
//# sourceMappingURL=list.js.map