"use strict";define("forum/category/tools",["topicSelect","forum/topic/threadTools","components","translator","api","bootbox"],function(e,t,n,o,i,r){var c={};c.init=function(){e.init(d);E();n.get("topic/delete").on("click",function(){a("del","/state","delete",p);return false});n.get("topic/restore").on("click",function(){a("put","/state","restore",p);return false});n.get("topic/purge").on("click",function(){a("del","","purge",p);return false});n.get("topic/lock").on("click",function(){a("put","/lock","lock",l);return false});n.get("topic/unlock").on("click",function(){a("del","/lock","unlock",l);return false});n.get("topic/pin").on("click",function(){a("put","/pin","pin",l);return false});n.get("topic/unpin").on("click",function(){a("del","/pin","unpin",l);return false});n.get("topic/mark-unread-for-all").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.markAsUnreadForAll",t,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");t.forEach(function(e){$('[component="category/topic"][data-tid="'+e+'"]').addClass("unread")});l()});return false});n.get("topic/move").on("click",function(){require(["forum/topic/move"],function(t){var n=e.getSelectedTids();if(!n.length){return app.alertError("[[error:no-topics-selected]]")}t.init(n,null,l)});return false});n.get("topic/move-all").on("click",function(){var e=ajaxify.data.cid;if(!ajaxify.data.template.category){return app.alertError("[[error:invalid-data]]")}require(["forum/topic/move"],function(t){t.init(null,e,function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});n.get("topic/merge").on("click",function(){var t=e.getSelectedTids();require(["forum/topic/merge"],function(e){e.init(function(){if(t.length){t.forEach(function(t){e.addTopic(t)})}})})});c.removeListeners();socket.on("event:topic_deleted",h);socket.on("event:topic_restored",h);socket.on("event:topic_purged",L);socket.on("event:topic_locked",y);socket.on("event:topic_unlocked",y);socket.on("event:topic_pinned",_);socket.on("event:topic_unpinned",_);socket.on("event:topic_moved",C)};function a(n,o,c,a){if(!a){a=function(){}}const s=e.getSelectedTids();const l={};const p=function(e){if(e){Promise.all(s.map(e=>i[n](`/topics/${e}${o}`,l))).then(a).catch(app.alertError)}};if(!s.length){return app.alertError("[[error:no-topics-selected]]")}switch(c){case"delete":case"restore":case"purge":r.confirm(`[[topic:thread_tools.${c}_confirm]]`,p);break;case"pin":t.requestPinExpiry(l,p.bind(null,true));break;default:p(true);break}}c.removeListeners=function(){socket.removeListener("event:topic_deleted",h);socket.removeListener("event:topic_restored",h);socket.removeListener("event:topic_purged",L);socket.removeListener("event:topic_locked",y);socket.removeListener("event:topic_unlocked",y);socket.removeListener("event:topic_pinned",_);socket.removeListener("event:topic_unpinned",_);socket.removeListener("event:topic_moved",C)};function s(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function l(){s();e.unselectAll()}function p(){s();d()}function d(){var t=e.getSelectedTids();var o=u(g,t);var i=f(g,t);var r=u(v,t);var c=u(k,t);n.get("topic/delete").toggleClass("hidden",o);n.get("topic/restore").toggleClass("hidden",!o);n.get("topic/purge").toggleClass("hidden",!i);n.get("topic/lock").toggleClass("hidden",c);n.get("topic/unlock").toggleClass("hidden",!c);n.get("topic/pin").toggleClass("hidden",r);n.get("topic/unpin").toggleClass("hidden",!r)}function u(e,t){for(var n=0;n<t.length;n+=1){if(e(t[n])){return true}}return false}function f(e,t){for(var n=0;n<t.length;n+=1){if(!e(t[n])){return false}}return true}function g(e){return m(e).hasClass("deleted")}function k(e){return m(e).hasClass("locked")}function v(e){return m(e).hasClass("pinned")}function m(e){return n.get("category/topic","tid",e)}function h(e){var t=m(e.tid);t.toggleClass("deleted",e.isDeleted);t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function _(e){var t=m(e.tid);t.toggleClass("pinned",e.isPinned);t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned);ajaxify.refresh()}function y(e){var t=m(e.tid);t.toggleClass("locked",e.isLocked);t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function C(e){m(e.tid).remove()}function L(e){m(e.tid).remove()}function E(){if(!ajaxify.data.topics||!ajaxify.data.template.category){return}var e=ajaxify.data.topics.reduce(function(e,t){e=t.pinned?e+=1:e;return e},0);if(!app.user.isAdmin&&!app.user.isMod||e<2){return}app.loadJQueryUI(function(){var e=$('[component="category"]').filter(function(e,t){return!$(t).parents("[widget-area],[data-widget-area]").length});e.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',update:function(){var t=[];var n=e.find('[component="category/topic"].pinned');n.each(function(e,o){t.push({tid:$(o).attr("data-tid"),order:n.length-e-1})});socket.emit("topics.orderPinnedTopics",t,function(e){if(e){return app.alertError(e.message)}})}})})}return c});
//# sourceMappingURL=tools.js.map