define("emoji-dialog",["require","exports","translator","benchpress","composer/controls","scrollStop","emoji"],function(e,t,n,i,o,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.toggleForInsert=t.toggle=t.init=t.dialogActions=void 0;var s=$("html");t.dialogActions={open:function(e){s.addClass("emoji-insert");e.addClass("open");e.find(".emoji-dialog-search").focus();return e},close:function(e){s.removeClass("emoji-insert");return e.removeClass("open")}};var c={people:10,nature:9,food:8,activity:7,travel:6,objects:5,symbols:4,flags:3,regional:2,modifier:1,other:0};if(config.emojiCustomFirst){c.custom=100}var l=n.Translator.create();function u(e,t){if(e<t){return-1}if(e>t){return 1}return 0}function f(e){Promise.all([$.getJSON(r.base+"/emoji/categories.json?"+r.buster),$.getJSON(r.base+"/emoji/packs.json?"+r.buster),new Promise(function(e){return r.init(e)})]).then(function(e){var t=e[0],n=e[1];var o=Object.keys(t).map(function(e){var n=t[e].map(function(e){return r.table[e]});return{name:e,emojis:n.map(function(e){return{name:e.name,html:r.buildEmoji(e,true)}}).sort(function(e,t){return u(e.name,t.name)})}}).sort(function(e,t){var n=c[e.name]||0;var i=c[t.name]||0;return i-n});return i.render("partials/emoji-dialog",{categories:o,packs:n})}).then(function(e){return l.translate(e)}).then(function(n){var i=$(n).appendTo("body");i.find(".emoji-dialog-search").on("input",function(e){var t=e.target.value;if(!t){i.find(".emoji-dialog-search-results").addClass("hidden");i.find(".nav-tabs .emoji-dialog-search-results").next().find("a").tab("show");return}var n=r.search(t).slice(0,100).map(function(e){return'<a class="emoji-link" name="'+e.name+'" href="#">'+r.buildEmoji(e,false)+"</a>"}).join("\n");i.find(".tab-pane.emoji-dialog-search-results").html(n);i.find(".emoji-dialog-search-results").removeClass("hidden");i.find(".nav-tabs .emoji-dialog-search-results a").tab("show")});var o=i.find(".emoji-tabs .tab-content");function s(e){var t=o[0].getBoundingClientRect();var n=Math.ceil(t.width*t.height/(40*40));e.find(".emoji-link img.defer").filter(function(e,i){if(e<=n){return true}var o=i.getBoundingClientRect();return o.right>t.left&&o.left<t.right&&o.bottom>t.top&&o.top<t.bottom}).removeClass("defer").each(function(e,t){var n=t.getAttribute("data-src");t.setAttribute("src",n)})}var c=i.find(".emoji-tabs .nav-tabs a").click(function(e){e.preventDefault();$(e.target).tab("show")}).on("show.bs.tab",function(e){s($(e.target.getAttribute("href")))}).eq(1);setTimeout(function(){return c.trigger("show.bs.tab")},10);o.on("scroll",function(){s(o.find(".tab-pane.active"))});a.apply(o[0]);var l=function(){return t.dialogActions.close(i)};$(window).on(["action:composer.discard","action:composer.submit","action:composer.minimize","action:chat.minimize","action:chat.closed"].join(" "),l);i.find(".close").click(l);$(document).on("click",function(e){if(!$(e.target).is(".emoji-dialog *")){l()}});if(i.draggable){i.draggable({handle:".top-bar"})}e(i)}).catch(function(e){console.error("Failed to initialize emoji dialog",e)})}t.init=f;function d(e,n){function i(i){if(i.hasClass("open")){t.dialogActions.close(i);return}i.off("click").on("click",".emoji-link",function(e){e.preventDefault();var t=e.currentTarget.name;n(e,t,i)});var o=e?e.getBoundingClientRect():{top:window.innerHeight/3,left:window.innerWidth/3};var a={bottom:"auto",top:"auto",right:"auto",left:"auto"};if(o.top>440){a.top=o.top-400+"px"}else{a.top=o.top+40+"px"}if(o.left<window.innerWidth/2){a.left=o.left+40+"px"}else{a.left=o.left-400+"px"}i.css(a);t.dialogActions.open(i)}var o=$("#emoji-dialog");if(o.length){i(o)}else{f(i)}}t.toggle=d;function m(e,t,n,i){var a;if(i&&i.target){a=$(i.target)}else{a=$(e).parents(".composer-container").find('[data-format="emoji-add-emoji"]')}a=a[0];d(a,function(t,n){var i=":"+n+": ";var a=e.selectionStart,r=e.selectionEnd;var s=r+i.length;var c=a===r?s:a;o.insertIntoTextarea(e,i);o.updateTextareaSelection(e,c,s);$(e).trigger("input")})}t.toggleForInsert=m});
//# sourceMappingURL=emoji-dialog.js.map