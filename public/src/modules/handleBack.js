"use strict";define("handleBack",["components","storage","navigator","forum/pagination"],function(t,o,e,a){var i={};var r;i.init=function(t){r=t;n();$(window).off("action:popstate",c).on("action:popstate",c)};i.onBackClicked=c;function n(){$('[component="category"]').on("click",'[component="topic/header"]',function(){var t=$(this).parents("[data-index]").attr("data-index");var e=$(window).scrollTop();$('[component="category/topic"]').each(function(a,i){if($(i).offset().top-e>0){o.setItem("category:bookmark",$(i).attr("data-index"));o.setItem("category:bookmark:clicked",t);o.setItem("category:bookmark:offset",$(i).offset().top-e);return false}})})}function c(t){var e=t&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||e){var n=o.getItem("category:bookmark");var c=o.getItem("category:bookmark:clicked");o.removeItem("category:bookmark");o.removeItem("category:bookmark:clicked");if(!utils.isNumber(n)){return}n=Math.max(0,parseInt(n,10)||0);c=Math.max(0,parseInt(c,10)||0);if(config.usePagination){var s=Math.ceil((parseInt(n,10)+1)/config.topicsPerPage);if(parseInt(s,10)!==ajaxify.data.pagination.currentPage){a.loadPage(s,function(){i.scrollToTopic(n,c)})}else{i.scrollToTopic(n,c)}}else{if(n===0){i.scrollToTopic(n,c);return}$('[component="category"]').empty();r(Math.max(0,n-1)+1,function(){i.scrollToTopic(n,c)})}}}i.highlightTopic=function(o){var e=t.get("category/topic","index",o);if(e.length&&!e.hasClass("highlight")){e.addClass("highlight");setTimeout(function(){e.removeClass("highlight")},5e3)}};i.scrollToTopic=function(a,r){if(!utils.isNumber(a)){return}var n=t.get("category/topic","index",a);if(n.length){var c=o.getItem("category:bookmark:offset");o.removeItem("category:bookmark:offset");$(window).scrollTop(n.offset().top-c);i.highlightTopic(r);e.update()}};return i});
//# sourceMappingURL=handleBack.js.map