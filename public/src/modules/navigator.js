"use strict";define("navigator",["forum/pagination","components"],function(t,o){var e={};var n=0;var a=0;var i;var r;var l;var f;var c;var s=false;var d=true;e.scrollActive=false;var u=$(".pagination-block");var p=u.find(".pagination-text");var g=u.find("meter");var h=u.find(".progress-bar");var v;var m;var w;var x;var T;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",j)});e.init=function(t,o,a,i,r){n=0;e.selector=t;e.callback=r;e.toTop=a||function(){};e.toBottom=i||function(){};u=$(".pagination-block");p=u.find(".pagination-text");g=u.find("meter");h=u.find(".progress-bar");w=$(".scroller-thumb-icon");x=w.height();T=x/2;v=$(".scroller-thumb");m=v.find(".thumb-text");$(window).off("scroll",e.delayedUpdate).on("scroll",e.delayedUpdate);u.find(".dropdown-menu").off("click").on("click",function(t){t.stopPropagation()});u.off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});u.find(".pageup").off("click").on("click",e.scrollUp);u.find(".pagedown").off("click").on("click",e.scrollDown);u.find(".pagetop").off("click").on("click",e.toTop);u.find(".pagebottom").off("click").on("click",e.toBottom);u.find("input").on("keydown",function(t){if(t.which===13){var o=$(this);if(!utils.isNumber(o.val())){o.val("");return}var e=parseInt(o.val(),10);var n=A(e);o.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(n)}});if(ajaxify.data.template.topic){k()}M();e.setCount(o);e.update(0)};function y(t){var o=v.parent();var e=o.offset();if(t<e.top){t=e.top}else if(t>e.top+o.height()-x){t=e.top+o.height()-x}return t}function b(t){if(!v.length||v.is(":hidden")){return}var o=v.parent();var e=o.offset();var n=(t-1)/ajaxify.data.postcount;if(t===a){n=1}var i=y(e.top+(o.height()-x)*n);var r={top:i,left:v.offset().left};v.offset(r);m.text(t+"/"+ajaxify.data.postcount);P(t)}function k(){if(!v.length){return}var t=v.parent();t.on("click",function(t){if($(t.target).hasClass("scroller-container")){var n=o(t.pageY);e.scrollToIndex(n-1,true,0);return false}});function o(o){var e=y(o-T);var a=t.offset();var i=(e-a.top)/(t.height()-x);n=Math.max(1,Math.ceil(ajaxify.data.postcount*i));return n>ajaxify.data.postcount?ajaxify.data.count:n}var a=false;$(window).on("action:ajaxify.end",function(){c=null});$(".pagination-block .dropdown-menu").parent().on("shown.bs.dropdown",function(){b(n)});v.on("mousedown",function(){a=true;$(window).on("mousemove",p);d=true});function i(){$(window).off("mousemove",p);if(a){e.scrollToIndex(n-1,true,0);u.find('[data-toggle="dropdown"]').trigger("click")}I();a=false;d=false}function p(t){var n=y(t.pageY-T);v.offset({top:n,left:v.offset().left});var a=o(t.pageY);e.updateTextAndProgressBar();m.text(a+"/"+ajaxify.data.postcount);if(d){g()}d=false;t.stopPropagation();return false}function g(){I();r=setInterval(function(){P(n)},250)}$(window).off("mousemove",p);$(window).off("mouseup",i).on("mouseup",i);v.on("touchstart",function(t){s=true;l=Math.min($(window).width(),Math.max(0,t.touches[0].clientX));f=Math.min($(window).height(),Math.max(0,t.touches[0].clientY));d=true});v.on("touchmove",function(t){var n=$(window).width();var a=$(window).height();var i=Math.abs(l-Math.min(n,Math.max(0,t.touches[0].clientX)));var r=Math.abs(f-Math.min(a,Math.max(0,t.touches[0].clientY)));l=Math.min(n,Math.max(0,t.touches[0].clientX));f=Math.min(a,Math.max(0,t.touches[0].clientY));if(r>=i&&d){s=true;g()}if(s&&t.cancelable){t.preventDefault();t.stopPropagation();var c=y(f+$(window).scrollTop()-T);v.offset({top:c,left:v.offset().left});var u=o(f+$(window).scrollTop());e.updateTextAndProgressBar();m.text(u+"/"+ajaxify.data.postcount);if(d){P(u)}}d=false});v.on("touchend",function(){I();if(s){e.scrollToIndex(n-1,true,0);s=false;u.find('[data-toggle="dropdown"]').trigger("click")}})}function I(){if(r){clearInterval(r);r=0}}function P(t,o){o=o||function(){};if(c===t||u.find(".post-content").is(":hidden")){return}c=t;socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1},function(t,e){if(t){return app.alertError(t.message)}app.parseAndTranslate("partials/topic/navigation-post",{post:e},function(t){u.find(".post-content").html(t).find(".timeago").timeago()});o()})}function M(){if(!config.usePagination){$(window).off("keydown",j).on("keydown",j)}}function j(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey){return}if(t.which===36&&e.toTop){e.toTop();return false}else if(t.which===35&&e.toBottom){e.toBottom();return false}}}function A(t){var o=window.location.pathname.replace(config.relative_path,"");var e=o.split("/");return e[1]+"/"+e[2]+"/"+e[3]+(t?"/"+t:"")}e.setCount=function(t){t=parseInt(t,10);if(t===a){return}a=t;e.updateTextAndProgressBar()};e.show=function(){B(true)};e.disable=function(){a=0;n=1;e.callback=null;e.selector=null;$(window).off("scroll",e.delayedUpdate);B(false)};function B(t){var o=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(t&&(!o.startsWith("topic")&&!o.startsWith("category"))){return}u.toggleClass("ready",t)}e.delayedUpdate=function(){if(!i){i=setTimeout(function(){e.update();i=undefined},100)}};e.update=function(t){t=typeof t==="number"?t:undefined;var i=n;var r=$(e.selector);if(r.length){i=parseInt(r.first().attr("data-index"),10)+1}var l=$(window).scrollTop();var f=$(window).height();var c=$(document).height();var s=l+f/2;var d=Number.MAX_VALUE;r.each(function(){var t=$(this);var o=parseInt(t.attr("data-index"),10);if(o>=0){var e=Math.abs(s-(t.offset().top+t.outerHeight(true)/2));if(e>d){return false}if(e<d){i=o+1;d=e}}});var u=l===0&&parseInt(r.first().attr("data-index"),10)===0;var p=l+f>c-100&&parseInt(r.last().attr("data-index"),10)===a-1;if(u){i=1}else if(p){i=a}if(t===undefined&&ajaxify.data.template.topic){if(u){t=0}else{var g=o.get("post/anchor",n-1);if(g.length){var h=g.get(0).getBoundingClientRect();t=h.top}}}if(typeof e.callback==="function"){e.callback(i,a,t)}if(i!==n){n=i;e.updateTextAndProgressBar();b(n)}B(!!a)};e.updateTextAndProgressBar=function(){if(!utils.isNumber(n)){return}n=n>a?a:n;p.translateHtml("[[global:pagination.out_of, "+n+", "+a+"]]");var t=(n-1)/(a-1||1);g.val(t);h.width(t*100+"%")};e.scrollUp=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()<=0;if(e){return t.previousPage(function(){$("body,html").scrollTop($(document).height()-o.height())})}}$("body,html").animate({scrollTop:o.scrollTop()-o.height()})};e.scrollDown=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()>=$(document).height()-o.height();if(e){return t.nextPage()}}$("body,html").animate({scrollTop:o.scrollTop()+o.height()})};e.scrollTop=function(t){if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{ajaxify.go(A())}};e.scrollBottom=function(t){if(parseInt(t,10)<0){return}if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{t=parseInt(t,10)+1;ajaxify.go(A(t))}};e.scrollToIndex=function(n,a,i){var r=!!o.get("topic").length;var l=!!o.get("category").length;if(!utils.isNumber(n)||!r&&!l){return}i=i!==undefined?i:400;e.scrollActive=true;if(r&&o.get("post/anchor",n).length){return e.scrollToPostIndex(n,a,i)}if(l&&$('[component="category/topic"][data-index="'+n+'"]').length){return e.scrollToTopicIndex(n,a,i)}if(!config.usePagination){e.scrollActive=false;n=parseInt(n,10)+1;ajaxify.go(A(n));return}var f=r?e.scrollToPostIndex:e.scrollToTopicIndex;var c=1+Math.floor(n/config.postsPerPage);if(parseInt(c,10)!==ajaxify.data.pagination.currentPage){t.loadPage(c,function(){f(n,a,i)})}else{f(n,a,i)}};e.scrollToPostIndex=function(t,n,a){var i=o.get("post","index",t);e.scrollToElement(i,n,a)};e.scrollToTopicIndex=function(t,o,n){var a=$('[component="category/topic"][data-index="'+t+'"]');e.scrollToElement(a,o,n)};e.scrollToElement=function(t,n,a){if(!t.length){e.scrollActive=false;return}var i=t.outerHeight(true);var r=o.get("navbar").outerHeight(true);var l=$(".topic-header").outerHeight(true)||0;var f=$(window).height();$(window).off("scroll",e.delayedUpdate);a=a!==undefined?a:400;e.scrollActive=true;var c=false;function s(){function o(){$(window).on("scroll",e.delayedUpdate);var o=t.get(0).getBoundingClientRect();e.update(o.top)}function n(){if(c){o();return}c=true;e.scrollActive=false;d();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)}var s=0;if(i<f-r-l){s=t.offset().top-f/2+i/2}else{s=t.offset().top-r-l}if(a===0){$(window).scrollTop(s);n();o();return}$("html, body").animate({scrollTop:s+"px"},a,n)}function d(){if(n){$('[component="post"],[component="category/topic"]').removeClass("highlight");t.addClass("highlight");setTimeout(function(){t.removeClass("highlight")},1e4)}}s()};return e});
//# sourceMappingURL=navigator.js.map