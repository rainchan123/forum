"use strict";define("uploader",["jquery-form"],function(){var e={};e.show=function(e,o){var t=e.hasOwnProperty("fileSize")&&e.fileSize!==undefined?parseInt(e.fileSize,10):false;app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==undefined?e.showHelp:true,fileSize:t,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(s){s.modal("show");s.on("hidden.bs.modal",function(){s.remove()});var i=s.find("#uploadForm");i.attr("action",e.route);i.find("#params").val(JSON.stringify(e.params));s.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled");i.submit()});i.submit(function(){r(s,t,o);return false})})};e.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function r(r,t,i){o(r,"status","[[uploads:uploading-file]]");r.find("#upload-progress-bar").css("width","0%");r.find("#upload-progress-box").show().removeClass("hide");var a=r.find("#fileInput");if(!a.val()){return o(r,"error","[[uploads:select-file-to-upload]]")}if(!s(a[0],t)){return o(r,"error","[[error:file-too-big, "+t+"]]")}e.ajaxSubmit(r,i)}function o(r,o,t){e.hideAlerts(r);if(o==="error"){r.find("#fileUploadSubmitBtn").removeClass("disabled")}r.find("#alert-"+o).translateText(t).removeClass("hide")}e.ajaxSubmit=function(r,s){const i=r.find("#uploadForm");const a=i.attr("action").startsWith(config.relative_path+"/api/v3/");i.ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=t(e);o(r,"error",e.responseJSON?e.responseJSON.error||e.statusText:"error uploading, code : "+e.status)},uploadProgress:function(e,o,t,s){r.find("#upload-progress-bar").css("width",s+"%")},success:function(i){i=t(i);if(a){if(i.status.code==="ok"){i=i.response.images}else{i={error:i.status.code}}}if(i.error){return o(r,"error",i.error)}s(i[0].url);o(r,"success","[[uploads:upload-success]]");setTimeout(function(){e.hideAlerts(r);r.modal("hide")},750)}})};function t(e){if(typeof e==="string"){try{return $.parseJSON(e)}catch(e){return{error:"[[error:parse-error]]"}}}return e}function s(e,r){if(window.FileReader&&r){return e.files[0].size<=r*1e3}return true}return e});
//# sourceMappingURL=uploader.js.map