"use strict";define("topicThumbs",["api","bootbox","uploader","benchpress","translator"],function(t,e,o,a,l){const d={};d.get=(e=>t.get(`/topics/${e}/thumbs`,{}));d.getByPid=(t=>fetch(`${config.relative_path}/api/post/pid/${t}`).then(t=>t.json()).then(t=>d.get(t.tid)));d.delete=((e,o)=>t.del(`/topics/${e}/thumbs`,{path:o}));d.deleteAll=(t=>{d.get(t).then(e=>{Promise.all(e.map(e=>d.delete(t,e.url)))})});d.upload=(t=>new Promise(e=>{o.show({title:"[[topic:composer.thumb_title]]",method:"put",route:config.relative_path+`/api/v3/topics/${t}/thumbs`},function(t){e(t)})}));d.modal={};d.modal.open=function(t){const{id:o,pid:s}=t;let{modal:i}=t;return new Promise(n=>{Promise.all([d.get(o),s?d.getByPid(s):[]]).then(t=>new Promise(e=>{e(t.reduce((t,e)=>t.concat(e)))})).then(t=>a.render("modals/topic-thumbs",{thumbs:t})).then(a=>{if(i){l.translate(a,function(t){i.find(".bootbox-body").html(t)})}else{i=e.dialog({title:"[[modules:thumbs.modal.title]]",message:a,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-primary",callback:()=>{d.upload(o).then(()=>{d.modal.open({...t,modal:i});n()});return false}}}});d.modal.handleDelete({...t,modal:i})}})})};d.modal.handleDelete=(o=>{const a=o.modal.get(0);a.addEventListener("click",a=>{if(a.target.closest('button[data-action="remove"]')){e.confirm("[[modules:thumbs.modal.confirm-remove]]",e=>{if(!e){return}const l=a.target.closest(".media[data-id]").getAttribute("data-id");const s=a.target.closest(".media[data-path]").getAttribute("data-path");t.del(`/topics/${l}/thumbs`,{path:s}).then(()=>{d.modal.open(o)}).catch(app.alertError)})}})});return d});
//# sourceMappingURL=topicThumbs.js.map