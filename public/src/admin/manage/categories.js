"use strict";define("admin/manage/categories",["translator","benchpress","categorySelector","api","Sortable"],function(a,e,t,i,n){var r={};var o=-1;var c;r.init=function(){r.render(ajaxify.data.categories);$('button[data-action="create"]').on("click",r.throwCreateModal);$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){var a=$(this);var e=a.attr("data-disable-cid");var t=a.parents('li[data-cid="'+e+'"]');var i=t.hasClass("disabled");var n=t.find("li[data-cid]");var o=n.map(function(){return $(this).attr("data-cid")}).get();r.toggle([e].concat(o),!i)});$(".categories").on("click",".toggle",function(){var a=$(this);a.find("i").toggleClass("fa-minus").toggleClass("fa-plus");a.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden")});$("#collapse-all").on("click",function(){a(false)});$("#expand-all").on("click",function(){a(true)});function a(a){var e=$(".categories .toggle");e.find("i").toggleClass("fa-minus",a).toggleClass("fa-plus",!a);e.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!a)}$("#category-search").on("keyup",function(){d()})};function d(){var a=$("#content .categories");function e(t){var i=a.find('li[data-cid="'+t+'"]').attr("data-parent-cid");if(i){a.find('li[data-cid="'+i+'"]').removeClass("hidden");e(i)}}function t(e){var i=a.find('li[data-parent-cid="'+e+'"]');i.each(function(a,e){var i=$(e);i.removeClass("hidden");t(i.attr("data-cid"))})}var i=a.find("li[data-cid]");var n=$("#category-search").val().toLowerCase();var r=true;var o=[];i.each(function(){var a=$(this);var e=a.attr("data-name").toLowerCase().indexOf(n)!==-1;if(r&&e){r=false}if(e&&n){o.push(a.attr("data-cid"))}a.toggleClass("hidden",!e)});o.forEach(function(a){e(a);t(a)});$('[component="category/no-matches"]').toggleClass("hidden",!r)}r.throwCreateModal=function(){socket.emit("categories.getSelectCategories",{},function(a,i){if(a){return app.alertError(a.message)}i.unshift({cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"});e.render("admin/partials/categories/create",{categories:i}).then(function(a){var e=bootbox.dialog({title:"[[admin/manage/categories:alert.create]]",message:a,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:o}}});var i=t.init(e.find('#parentCidGroup [component="category-selector"]'));var n=t.init(e.find('#cloneFromCidGroup [component="category-selector"]'));function o(){var a=e.find("form").serializeObject();a.description="";a.icon="fa-comments";a.uid=app.user.uid;a.parentCid=i.getSelectedCid();a.cloneFromCid=n.getSelectedCid();r.create(a);e.modal("hide");return false}$("#cloneChildren").on("change",function(){var a=$(this);var t=e.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');if(a.prop("checked")){t.attr("disabled","disabled");i.selectCategory(0)}else{t.removeAttr("disabled")}});e.find("form").on("submit",o)})})};r.create=function(a){i.post("/categories",a,function(a,e){if(a){return app.alertError(a.message)}app.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3});ajaxify.go("admin/manage/categories/"+e.cid)})};r.render=function(e){var t=$(".categories");if(!e||!e.length){a.translate("[[admin/manage/categories:alert.none-active]]",function(a){$("<div></div>").addClass("alert alert-info text-center").text(a).appendTo(t)})}else{c={};g(e,t,0)}};r.toggle=function(a,e){const t=document.querySelector(".categories ul");Promise.all(a.map(a=>i.put("/categories/"+a,{disabled:e?1:0}).then(()=>{const i=t.querySelector(`li[data-cid="${a}"]`);i.classList[e?"add":"remove"]("disabled");$(i).find('li a[data-action="toggle"]').first().translateText(e?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(app.alertError)))};function s(a){o=a.to.dataset.cid}function l(a){var e=parseInt(o,10)!==-1;if(a.newIndex!=null&&parseInt(a.oldIndex,10)!==parseInt(a.newIndex,10)||e){var t=e?c[o]:c[a.from.dataset.cid];var n={};var r=0;var d=t.toArray();var s=d.length;for(r;r<s;r+=1){n[d[r]]={order:r+1}}if(e){n[a.item.dataset.cid].parentCid=o}o=-1;Object.keys(n).map(a=>i.put("/categories/"+a,n[a]))}}function g(e,t,i){var r=0;e.forEach(function(e,t,i){a.translate(e.name,function(a){if(e.name!==a){e.name=a}r+=1;if(r===i.length){o()}})});if(!e.length){o()}function o(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:i,categories:e},function(a){t.append(a);for(var r=0,o=e.length;r<o;r+=1){g(e[r].children,$('li[data-cid="'+e[r].cid+'"]'),e[r].cid)}c[i]=n.create($('ul[data-cid="'+i+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:s,onEnd:l})})}}return r});
//# sourceMappingURL=categories.js.map